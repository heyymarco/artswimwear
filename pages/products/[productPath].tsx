import Head from 'next/head'
// import { Inter } from 'next/font/google'
// import styles from '@/styles/Home.module.scss'
import { Main } from '@/components/sections/Main'
import { Busy, Button, ButtonIcon, Carousel, Group, Input, Nav, NavItem } from '@reusable-ui/components'
import { dynamicStyleSheets } from '@cssfn/cssfn-react'
import { GenericSection } from '@/components/sections/GenericSection'
import { useGetProductDetailQuery } from '@/store/features/api/apiSlice'
import { formatCurrency } from '@/libs/formatters'
import ImageWithFallback from '@/components/ImageWithFallback'
import Link from 'next/link'
import { useRouter } from 'next/router'
import { Section } from '@/components/sections/Section'
import ReactMarkdown from 'react-markdown'
import { useState } from 'react'



// const inter = Inter({ subsets: ['latin'] })
const useProductDetailStyleSheet = dynamicStyleSheets(
    () => import(/* webpackPrefetch: true */'@/styles/productDetail')
, { id: 'prod-dtl' });



export default function ProductDetail() {
    const styles = useProductDetailStyleSheet();
    const router = useRouter();
    const {data: product, error, isLoading} = useGetProductDetailQuery(router.query.productPath as any ?? '');
    const [addProductQty, setAddProductQty] = useState(1);
    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app" />
            </Head>
            <Main nude={true}>
                <Section className={`${styles.prodDtl} ${(isLoading || error || !product) ? 'loading' : ''}`} theme='secondary'>
                    {
                        isLoading
                        ? <Busy theme='primary' size='lg' />
                        : (error || !product)
                        ? <p>Oops, an error occured!</p>
                        : <>
                            <section className='nav'>
                                <Nav orientation='inline' theme='primary' listStyle='breadcrumb'>
                                    <NavItem end><Link href='/'>Home</Link></NavItem>
                                    <NavItem end><Link href='/products'>Products</Link></NavItem>
                                    {!!product.path && <NavItem end><Link href={`/products/${product.path}`} >{product.name}</Link></NavItem>}
                                </Nav>
                            </section>
                            <section className='images'>
                                <Carousel className='slides' size='lg' theme='primary'>
                                    {product.images?.map((img: string, index: number) =>
                                        <figure className='img-frame' key={index}>
                                            <ImageWithFallback src={`/products/${product.name}/${img}`} alt={`image #${index + 1} of ${product.name}`} fill={true} priority={true} sizes='100vw' />
                                        </figure>
                                    )}
                                </Carousel>
                            </section>
                            <section className='addToCart'>
                                <h1 className='name h4'>
                                    {product.name}
                                </h1>
                                <span className='price h5'>
                                    {formatCurrency(product.price)}
                                </span>
                                <p>
                                    Quantity:
                                    <Group theme='primary' className='ctrlQty'>
                                        <ButtonIcon icon='remove' label='decrease' enabled={addProductQty > 1} onClick={() => setAddProductQty((currentValue) => Math.max(currentValue - 1, 1))} />
                                        <Input type='number' min={1} max={9} value={addProductQty} onChange={(event) => setAddProductQty(event.currentTarget.valueAsNumber || 1)} />
                                        <ButtonIcon icon='add' label='increase' enabled={addProductQty < 9} onClick={() => setAddProductQty((currentValue) => Math.min(currentValue + 1, 9))} />
                                    </Group>
                                </p>
                                <p>
                                    <ButtonIcon icon='add_shopping_cart' size='lg' gradient={true} theme='primary' className='ctrlAction'>Add to cart</ButtonIcon>
                                </p>
                            </section>
                            {!!product.description && <section className='desc'>
                                <ReactMarkdown>
                                    {product.description}
                                </ReactMarkdown>
                            </section>}
                        </>
                    }
                </Section>
            </Main>
        </>
    )
}
